{% extends 'base.html' %}
{% load static %}
{% block content %}


<div class="hero_area">
  <!-- header section strats -->
  <header class="header_section">
    <div class="header_top">
      <div class="container-fluid">
        <div class="top_nav_container">
          <div class="contact_nav">
            <a href="">
              <i class="fa fa-phone" aria-hidden="true"></i>
              <span>
                Call : +01 123455678990
              </span>
            </a>
            <a href="">
              <i class="fa fa-envelope" aria-hidden="true"></i>
              <span>
                Email : django@gmail.com
              </span>
            </a>
          </div>
          <form class="search_form">
            <input type="text" class="form-control" placeholder="Search here...">
            <button class="" type="submit">
              <i class="fa fa-search" aria-hidden="true"></i>
            </button>
          </form>
          <div class="user_option_box">
            <a href="{% url 'logout' %}" class="account-link">
              <i class="fa fa-user" aria-hidden="true"></i>
              <span>
                logout
              </span>
            </a>
            <a href="" class="cart-link">
              <i class="fa fa-shopping-cart" aria-hidden="true"></i>
              <span>
                Cart
              </span>
            </a>
          </div>
        </div>

      </div>
    </div>
    <div class="header_bottom">
      <div class="container-fluid">
        <nav class="navbar navbar-expand-lg custom_nav-container ">
          <a class="navbar-brand" href="index.html">
            <span>
              COSMICS
            </span>
          </a>

          <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class=""> </span>
          </button>

          <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav ">
              <li class="nav-item active">
                <a class="nav-link" href="{% url 'cosmic' %}">Home <span class="sr-only">(current)</span></a>
              </li>
              <!-- <li class="nav-item">
                <a class="nav-link" href="#about_section"> About</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="#products">Products</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="#why">Why Us</a>
              </li> -->
              <li class="nav-item">
                <!-- <a class="nav-link" href="testimonial.html">Testimonial</a> -->
              </li>
            </ul>
          </div>
        </nav>
      </div>
    </div>
  </header>

  <!--cart section start here-->
  <div class="container my-5 ">
    <!-- <div class="cart container-fluid m-0 p-3 mx-auto w-50">
      <div class="cart-top d-flex justify-content-between p-3 " style="height: fit-content;">
        <div>
          <h2 class="cart-top-title p-0">Checkout</h2>
        </div>
        <div>
          Quantity
        </div>
        <div class="cart-top-info">3 items</div>
      </div>

      <div class="cartcontent ">

        <div class="d-flex justify-content-between p-3 ">
        <div class="cart-item">
          <span class="cart-item-pic">
            <img src="http://upload.wikimedia.org/wikipedia/en/a/a7/Random_Access_Memories.jpg">
          </span>
          Item #1
          <span class="cart-item-desc">Description</span>
          <span class="cart-item-price">$16.80</span>
          <a href=""> <button style="border-radius: 20px; background-color: yellow;">Remove</button> </a>
        </div>

        <div>
          <div id="app bg-dark">
            <div class="wrapper d-flex">
                  <button class="btn btn--minus" @click="changeCounter('-1')" type="button" name="button">
                  -
                  </button>
                  <input class="quantity w-25" type="text" name="name" :value="counter" >
                  <button class="btn btn--plus" @click="changeCounter('1')" type="button" name="button">
                    +
                  </button>
                </div>
        
          </div>
        </div>
        <div>
          <a href=""> <button style="border-radius: 20px; background-color: yellow;">Remove</button> </a>

        </div>
      </div>

        <div class="cart-bottom">
          Total: $54.80
          <a href="{% url 'address' %}" class="cart-button">Continue</a>
        </div>
      </div>
    </div> -->


 

    <div class="table datatable mt-5" id="pdftable">
      <table class="table datatable" style="margin-left: 0%;">
        <thead>
          <tr class="users-table-info">
            <th class="p-3">
              
              Customer
              
            </th>
            <th> Number of Products</th>
            <th> Ordered Date </th>
            <th>Amount</th>
            <th>Action</th>
            <th> Order Details </th>
            
            
          </tr>
        </thead>
        <tbody>
          {% for i in order %}
          <tr>
            <td >
              
                {{i.user}}
              
               
              
            </td>
            <td>
              {{ i.get_cart_items }}
            </td>
            <td>
              {{i.date_order}}
            </td>
           
            <td>
              {{i.get_cart_total}}
            </td>
            <td>
              <div>
                {% if i.status != 'Cancelled' %}
                <a href="{% url 'usercancelorder' i.id %}"><button
                        class="btn btn-outline-danger">Cancel</button></a>
                {% else %}
                <button class="btn btn-outline-danger" > Cancelled </button>
                {% endif %}
            </div>
            </td>
            <td>
                <a href="{% url 'user_invoice' i.id %}">  <button class="btn btn-outline-primary" > Order Details </button>   </a>  
            </td>
            
  
            
          </tr>
         {% endfor %}
        </tbody>
      </table>
  </div>


   
    
  </div>



 





  <!-- end header section -->
  <!-- slider section -->


  <!-- product section -->

  <!-- client section -->
  <!-- 
  <section class="client_section layout_padding-bottom">
    <div class="container">
      <div class="heading_container heading_center">
        <h2>
          What Says Our Customers
        </h2>
      </div>
    </div>
    <div class="client_container ">
      <div id="carouselExample2Controls" class="carousel slide" data-ride="carousel">
        <div class="carousel-inner">
          <div class="carousel-item active">
            <div class="container">
              <div class="box">
                <div class="detail-box">
                  <p>
                    <i class="fa fa-quote-left" aria-hidden="true"></i>
                  </p>
                  <p>
                    It is a long established fact that a reader will be distracted by the readable content of a page
                    when looking at its layout. The point of using Lorem Ipsum is that it has a more-or-less normal
                    distribution of letters, as opposed to using 'Content here, content here', making it lookIt is a
                    long established fact that a reader will be distracted by the readable content of a page when
                    looking at its layout. The point of using Lorem Ipsum is that it has a more-or-less normal
                    distribution of letters, as opposed to using 'Content here, content here', making it look
                  </p>
                </div>
                <div class="client-id">
                  <div class="img-box">
                    <img src="images/client.jpg" alt="">
                  </div>
                  <div class="name">
                    <h5>
                      James Dew
                    </h5>
                    <h6>
                      Photographer
                    </h6>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="carousel-item">
            <div class="container">
              <div class="box">
                <div class="detail-box">
                  <p>
                    <i class="fa fa-quote-left" aria-hidden="true"></i>
                  </p>
                  <p>
                    It is a long established fact that a reader will be distracted by the readable content of a page
                    when looking at its layout. The point of using Lorem Ipsum is that it has a more-or-less normal
                    distribution of letters, as opposed to using 'Content here, content here', making it lookIt is a
                    long established fact that a reader will be distracted by the readable content of a page when
                    looking at its layout. The point of using Lorem Ipsum is that it has a more-or-less normal
                    distribution of letters, as opposed to using 'Content here, content here', making it look
                  </p>
                </div>
                <div class="client-id">
                  <div class="img-box">
                    <img src="images/client.jpg" alt="">
                  </div>
                  <div class="name">
                    <h5>
                      James Dew
                    </h5>
                    <h6>
                      Photographer
                    </h6>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="carousel-item">
            <div class="container">
              <div class="box">
                <div class="detail-box">
                  <p>
                    <i class="fa fa-quote-left" aria-hidden="true"></i>
                  </p>
                  <p>
                    It is a long established fact that a reader will be distracted by the readable content of a page
                    when looking at its layout. The point of using Lorem Ipsum is that it has a more-or-less normal
                    distribution of letters, as opposed to using 'Content here, content here', making it lookIt is a
                    long established fact that a reader will be distracted by the readable content of a page when
                    looking at its layout. The point of using Lorem Ipsum is that it has a more-or-less normal
                    distribution of letters, as opposed to using 'Content here, content here', making it look
                  </p>
                </div>
                <div class="client-id">
                  <div class="img-box">
                    <img src="images/client.jpg" alt="">
                  </div>
                  <div class="name">
                    <h5>
                      James Dew
                    </h5>
                    <h6>
                      Photographer
                    </h6>
                  </div>
                </div>
              </div> -->
  <!-- </div>
          </div>
        </div>
        <div class="carousel_btn-box">
          <a class="carousel-control-prev" href="#carouselExample2Controls" role="button" data-slide="prev">
            <span>
              <i class="fa fa-angle-left" aria-hidden="true"></i>
            </span>
            <span class="sr-only">Previous</span>
          </a>
          <a class="carousel-control-next" href="#carouselExample2Controls" role="button" data-slide="next">
            <span>
              <i class="fa fa-angle-right" aria-hidden="true"></i>
            </span>
            <span class="sr-only">Next</span>
          </a>
        </div>
      </div>
    </div>
  </section> -->
  <!-- end client section -->

  <!-- info section -->
  <section class="info_section ">
    <div class="container">
      <div class="row">
        <div class="col-md-3">
          <div class="info_contact">
            <h5>
              <a href="" class="navbar-brand">
                <span>
                  Minics
                </span>
              </a>
            </h5>
            <p>
              <i class="fa fa-map-marker" aria-hidden="true"></i>
              Address
            </p>
            <p>
              <i class="fa fa-phone" aria-hidden="true"></i>
              +01 1234567890
            </p>
            <p>
              <i class="fa fa-envelope" aria-hidden="true"></i>
              demo@gmail.com
            </p>
          </div>
        </div>
        <div class="col-md-3">
          <div class="info_info">
            <h5>
              Information
            </h5>
            <p>
              Eligendi sunt, provident, debitis nemo, facilis cupiditate velit libero dolorum aperiam enim nulla iste
              maxime corrupti ad illo libero minus.
            </p>
          </div>
        </div>
        <div class="col-md-3">
          <div class="info_links">
            <h5>
              Useful Link
            </h5>
            <ul>
              <li>
                <a href="index.html">
                  Home
                </a>
              </li>
              <li>
                <a href="about.html">
                  About
                </a>
              </li>
              <li>
                <a href="product.html">
                  Products
                </a>
              </li>
              <li>
                <a href="why.html">
                  Why Us
                </a>
              </li>
              <li>
                <!-- <a href="testimonial.html">
                  Testimonial
                </a> -->
              </li>
            </ul>
          </div>
        </div>
        <div class="col-md-3">
          <div class="info_form ">
            <h5>
              Newsletter
            </h5>
            <form action="">
              <input type="email" placeholder="Enter your email">
              <button>
                Subscribe
              </button>
            </form>
            <div class="social_box">
              <a href="">
                <i class="fab fa-facebook-f"></i>
              </a>
              <a href="">
                <i class="fab fa-twitter-square"></i>
              </a>
              <a href="">

                <i class="fab fa-instagram"></i>
              </a>
              <a href="">

                <i class="fab fa-youtube"></i>
              </a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- end info_section -->


  <!-- footer section -->
  <footer class="footer_section">
    <div class="container">
      <p>
        &copy; <span id="displayYear"></span> All Rights Reserved By
        <a href="https://html.design/"> django house </a>
      </p>
    </div>
  </footer>
  <!-- footer section -->

  <!-- jQery -->

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
  <script src="https://www.paypal.com/sdk/js?client-id=AeS1O53pS0XIj2PQq6VCwSi4eTAhyFwrm04d-I8l8sYKaPdVOOFPq87afE5QgTGDQM6jd-K01_5Mu2p-&currency=USD" data-sdk-integration-source="button-factory"></script>

    <!--salmu code starts from here -->


    <!-- <script>
      console.log('salman')
      var total_amount = parseFloat('{{order.get_cart_total}}')
      var inr_total = total_amount/75
      paypal_sdk.Buttons({
  
        // Sets up the transaction when a payment button is clicked
        createOrder: function(data, actions) {
          return actions.order.create({
            purchase_units: [{
              amount: {
                value: inr_total.toFixed(2) // Can reference variables or functions. Example: `value: document.getElementById('...').value`
              }
            }]
          });
        },
  
        // Finalize the transaction after payer approval
        onApprove: function(data, actions) {
          return actions.order.capture().then(function(orderData) {
            // Successful capture! For dev/demo purposes:
                
                var transaction = orderData.purchase_units[0].payments.captures[0];
                
            console.log('salman')
            // When ready to go live, remove the alert and show a success message within this page. For example:
            // var element = document.getElementById('paypal-button-container');
            // element.innerHTML = '';
            // element.innerHTML = '<h3>Thank you for your payment!</h3>';
            // Or go to another URL:  actions.redirect('thank_you.html');
               data = {
                  'order_id': orderData.id,
              }
              $.ajax({
                  
                  method :"POST",
                  url: "/order_by_paypal",
                  data: data,
                  
                  success: function (responsec) {
                      alert("Success");
                      window.location.href = '/'
                      
                      
                  }
              });  
          });
        }
      }).render('#paypal-button-container');
  
    </script> -->




 
    <!--salmu code ends here-->




    <!--wafi code starts from here-->
  //<script>
  //  var price = parseFloat('{{ order.get_cart_total }}')
  //  console.log(price)
  //  paypal.Buttons({
//
  //    // Sets up the transaction when a payment button is clicked
  //    createOrder: function (data, actions) {
  //      return actions.order.create({
  //        purchase_units: [{
  //          amount: {
  //            value: parseFloat(price).toFixed(2) // Can reference variables or functions. Example: `value: document.getElementById('...').value`
  //          }
  //        }]
  //      });
  //    },
//
  //    // Finalize the transaction after payer approval
  //    onApprove: function (data, actions) {
  //      return actions.order.capture().then(function (orderData) {
//
  //        
  //        // Successful capture! For dev/demo purposes:
  //        console.log('Capture result', orderData, JSON.stringify(orderData, null, 2))
  //       // var transaction = orderData.purchase_units[0].payments.captures[0];
  //        //alert('Transaction ' + transaction.status + ': ' + transaction.id + '\n\nSee console for all available details');
//
  //        // When ready to go live, remove the alert and show a success message within this page. For example:
  //        // var element = document.getElementById('paypal-button-container');
  //        // element.innerHTML = '';
  //        // element.innerHTML = '<h3>Thank you for your payment!</h3>';
  //        // Or go to another URL:  actions.redirect('thank_you.html');
  //      });
  //    }
  //  }).render('#paypal-button-container');
//
  //</script>

  <script>
    // Render the PayPal button into #paypal-button-container
    var totalinr = parseFloat('{{ order.get_cart_total }}')
    var totalamt = totalinr / 75
    paypal.Buttons({
            // Set up the transaction
            createOrder: function (data, actions) {
                return actions.order.create({
                    purchase_units: [
                        {
                            amount: {
                                value: parseFloat(totalamt).toFixed(2),
                            },
                        },
                    ],
                });
            },

            onApprove: function (data, actions) {
              return actions.order.capture().then(function (orderData) {
                console.log(
                  "Capture result",
                  orderData,
                  JSON.stringify(orderData, null, 2)
                );
                $.ajax({
                  method: "POST",
                  url: '{% url "order_by_paypal" %}',
                  data: {'data':data},
                  
                  success: function (responsec) {
                      Swal.fire({
                          position: 'top-end',
                          icon: 'success',
                          title: 'Your order has been placed',
                          showConfirmButton: false,
                          timer: 1500
                      })
                      location = '{% url "cosmic" %}';
                  }
              });
              });
            },
          })
          .render("#paypal-button-container");

            // Finalize the transaction
           
</script>




  <!--////////////////////////wafi////////////wafirazorpay///////////////-->
  <!-- <script>
      // Render the PayPal button into #paypal-button-container
      var rs_in = parseFloat('{{ order.get_cart_total }}')
      var total_usd = rs_in / 75
      paypal
        .Buttons({
          // Set up the transaction
          createOrder: function (data, actions) {
            return actions.order.create({
              purchase_units: [
                {
                  amount: {
                    value: parseFloat(total_usd).toFixed(2),
                  },
                },
              ],
            });
          },
    
          // Finalize the transaction
          onApprove: function (data, actions) {
            return actions.order.capture().then(function (orderData) {
              console.log(
                "Capture result",
                orderData,
                JSON.stringify(orderData, null, 2)
              );
              order_place();
            });
          },
        })
        .render("#paypal-button-container");
    </script> -->

  <script>
    $(document).ready(function () {

      $('#rzp-button1').click(function () {
        var address = $('input[name="address"]:checked').val();


        $.ajax({
          method: 'GET',
          url: '{% url "razorpay" %}',
          data: {
            address: address
          },
          success: function (response) {
            console.log(response)


            var options = {
              "key": "rzp_test_3N7o3ki2CcSEKS", // Enter the Key ID generated from the Dashboard
              "amount": response.total * 100, // Amount is in currency subunits. Default currency is INR. Hence, 50000 refers to 50000 paise
              "currency": "INR",
              "name": "Hrishi S Vijayan",
              "description": "Thank you for buying from us",
              "image": "https://example.com/your_logo",
              "handler": function (response) {
                alert(response.razorpay_payment_id);
                order_place();
              },
              "prefill": {
                "name": response.name,
                "email": response.email,
                "contact": response.phone
              },
              "theme": {
                "color": "#3399cc"
              }
            };
            var rzp1 = new Razorpay(options);
            rzp1.open();

          }
        })

      })

    })
  </script>

  <script>
    var address = $('input[name="address"]:checked').val();
    $("#proceed").on("click", function (e) {
      console.log('hello proceed')
      order_place();
    });
    function order_place() {
      alert("Michu")
      var payment = $('input[name="payment"]:checked').val();
      var address = $('input[name="address"]:checked').val();
      $.ajax({
        type: "POST",
        url: "{% url 'proceed' %}",
        data: {
          payment: payment,
          address: address,
          csrfmiddlewaretoken: "{{ csrf_token }}",
        },
        dataType: "json",
        success: function (response) {
          location = '{% url "home" %}';
        },
      });

    }

    $("input[type=radio][name=address]").change(function () {
      var id = "#" + $(this).val();
      var html = "<h3>SELECTED ADDRESS</h3>" + $(id).html();
      $(".selected").html(html);
      $(".selected input").remove();
    });

    $("input[type=radio][name=payment]").click(function () {
      var address = $('input[name="address"]:checked').val();
      var id = "div" + $(this).val();
    //  if (address != undefined) {
    //    if ($("#div_COD").hasClass("d-block")) {
    //      var element = document.getElementById("div_COD");
    //      element.classList.toggle("d-block");
    //      element.classList.toggle("d-none");
    //    }
    //    if ($("#div_PayPal").hasClass("d-block")) {
    //      var element = document.getElementById("div_PayPal");
    //      element.classList.toggle("d-block");
    //      element.classList.toggle("d-none");
    //    }
    //    if ($("#div_RazorPay").hasClass("d-block")) {
    //      var element = document.getElementById("div_RazorPay");
    //      element.classList.toggle("d-block");
    //      element.classList.toggle("d-none");
    //    }
    //    var element = document.getElementById(_id);
    //    element.classList.toggle("d-block");
    //    element.classList.toggle("d-none");
    //  } else {
    //    alert("please select address");
    //  }
    });
  </script>

  <!--////////////////////////wafi razor pay over//////////////////////////-->



  {% endblock %}