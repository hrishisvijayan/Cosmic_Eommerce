{% extends 'base.html' %}
{% load static %}
{% block content %}

<aside class="navbar-aside" id="offcanvas_aside">
  <div class="aside-top">
      <a href="{% url 'admin_home' %}" class="brand-wrap">

          <h4>COSMIC</h4>
      </a>
      <div>
          <button class="btn btn-icon btn-aside-minimize"> <i class="text-muted material-icons md-menu_open"></i>
          </button>
      </div>
  </div>
  <nav>
      <ul class="menu-aside">
          <li class="menu-item ">
              <a class="menu-link" href="{% url 'admin_home' %}"> <i class="icon material-icons md-home"></i>
                  <span class="text">Dashboard</span>
              </a>
          </li>



          <li class="menu-item">
              <a class="menu-link" href="{% url 'adminuserslist' %}"> <i class="icon material-icons md-person"></i>
                  <span class="text">Users</span>
              </a>
          </li>



          <li class="menu-item">
              <a class="menu-link" href="{% url 'productslist' %}"> <i
                  class="icon material-icons md-shopping_bag"></i>
                  <span class="text"> Products </span>
              </a>
          </li>


          <li class="menu-item">
              <a class="menu-link" href="{% url 'adminorder' %}"> <i class="icon material-icons md-person"></i>
                  <span class="text"> Orders </span>
              </a>
          </li>


          <li class="menu-item">
              <a class="menu-link" href="{% url 'category_management' %}"> <i
                      class="icon material-icons md-person"></i>
                  <span class="text"> Category management </span>
              </a>
          </li>



          <li class="menu-item active">
              <a class="menu-link" href="{% url 'adminsale' %}"> <i class="icon material-icons md-person"></i>
                  <span class="text"> Sales Report </span>
              </a>
          </li>

          <li class="menu-item ">
              <a class="menu-link" href="{% url 'offer_management' %}"> <i class="icon material-icons md-person"></i>
                  <span class="text"> offer management </span>
              </a>
          </li>

          <li class="menu-item ">
              <a class="menu-link" href="{% url 'coupon_manage' %}"> <i class="icon material-icons md-person"></i>
                  <span class="text"> coupon management </span>
              </a>
          </li>


      </ul>
      <hr>
      <ul class="menu-aside">

      </ul>
      <br>
      <br>
  </nav>
</aside>

<div class="hero_area">
  <!-- header section strats -->
  <header class="main-header navbar ">
    <div class="col-search ">
      
    </div>
    <div class="col-nav ">
    
        <ul class="nav ">

            
            <li> <a href="{% url 'adminlogout' %}"> logout </a> </li>
        </ul>
    </div>
</header>

<h1 style="text-align: center; font-size: large; margin-top: 2%;" > Sales Report </h1>

  <!--cart section start here-->
  <div class="container my-5 ">
  

   
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">


<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
    crossorigin="anonymous"></script>

<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"
    integrity="sha384-IQsoLXl5PILFhosVNubq5LC7Qb9DXgDA9i+tQ8Zj3iwWAwPtgFTxbJ8NT4GN1R8p"
    crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js"
    integrity="sha384-cVKIPhGWiC2Al4u+LWgxfKTRIcfu0JTxR+EQDz/bgldoEyl4H0zUF0QKbrJ0EcQF"
    crossorigin="anonymous"></script>
<!-- content -->




<div class="col-10" style="margin-left: 250px;" >
  <!-- <h2 class="main-title m-2 ">Sales Table</h2> -->
 
  
  
<form action="" method="post"style="background-color:gray;padding: 30px;">
    {% csrf_token %}
    <div class="row m-1 stat-cards">
      <div class=" col-xl-4 mb-1 " >
        <article class="stat-cards-item " >
          

          <div class="stat-cards-info " style="width: 100%;" >
            <p class="stat-cards-info__num"><input type="text" class="ms-2" name="dates"  /></p>
            <p class="stat-cards-info__title">SelectBy Range:</p>
            <div class="d-flex " style="justify-content: space-between;">
              <button class="btn btn-success m-1" style="width: 30%;" id="submit_date" type="submit">OK</button>
              <!-- <a class="btn btn-danger m-1" style="width: 30%;" href="{% url 'adminsale' %}">RESET</a> -->
            </div>
          </div>
        </article>
      </div>
      <div class=" col-xl-4 mb-1" >
        <article class="stat-cards-item">
          
          <div class="stat-cards-info" style="width: 100%;"  >
            <p class="stat-cards-info__num"><select name="month" id="">
              <option value="">---------</option>
              {% for month in months %}
              <option value="{{ forloop.counter }}">{{ month }}</option>
              {% endfor %}
            </select></p>
            <p class="stat-cards-info__title">Select By Month :</p>
            <div class="d-flex " style="justify-content: space-between;">
              <button class="btn btn-success m-1" style="width: 30%;" id="submit_date" type="submit">OK</button>
              <!-- <a class="btn btn-danger m-1" style="width: 30%;" href="{% url 'adminsale' %}">RESET</a> -->
            </div>
          </div>
        </article>
      </div>
      <div class=" col-xl-4 mb-1"  >
        <article class="stat-cards-item"  >
          
          <div class="stat-cards-info" style="width: 100%;">
            <p class="stat-cards-info__num"><select name="year" id="">
              <option value="">---------</option>
              {% for year in years %}
              <option value="{{ year }}">{{ year }}</option>
              {% endfor %}
            </select></p>
            <p class="stat-cards-info__title">Select By Year :</p>
            <div class="d-flex " style="justify-content: space-between;">
              <button class="btn btn-success m-1" style="width: 30%;" id="submit_date" type="submit">OK</button>
              <!-- <a class="btn btn-danger m-1" style="width: 30%;" href="{% url 'adminsale' %}">RESET</a> -->
            </div>
          </div>
        </article>
      </div>
    </div>
    
</form>

</div>

<main class="main users chart-page" id="skip-target" style="margin-left: 250px;" >
  <div class="container ">
   
   
      <div class="row" id="salestable" >

      <div class="col-lg-12" >
          <div class="table users-table table-wrapper"  >
            
            


            <div>

            
              <table class="posts-table table " style="width:100%" id="salestable2" >
                <thead >
                  <tr class="users-table-info">
                    <th class="">
                      
                      User Id
                      
                    </th>
                    <th>Customer Name</th>
                    <th>Number of Products</th>
                    <th>Ordered Date</th>
                    <th>Amount</th>
                    <th>Payment Type</th>
                    
                  </tr>
                </thead>
                <tbody>
                  {% for data in order_data %}
                  
                  <tr>
                    <td>
                      
                        {{data.id}}
                      
                    </td>
                    <td>
                      {{ data.order.user }}
                    </td>
                    <td>
                      {{data.order.get_cart_items}}
                    </td>
                    <td>
                      {{data.order.date_order}}
                    </td>
                    <td>
                      {{data.order.payments.total_amount}}
                    </td>
                    <td>
                      {{data.order.payments.payment_method}}
                    </td> 
                  </tr>
                  
                {% endfor %}
                </tbody>
              </table>
            </div> 
          </div>
      </div>
    </div>
    <div class="row m-1 "> 
      <div class="col-lg-4 mb-2" >
          <a href="{% url 'export_csv' %}" style="width: 100%;" class="btn btn-secondary" onclick="csvBtn(this.href,event)">Export CSV</a>
      </div>
      <div class="col-lg-4 mb-2">
        <a href="{% url 'export_excel' %}" style="width: 100%;" class="btn btn-secondary" onclick="ExportToExcel('xlsx',event)">Export Excel</a>
      </div>
      <div class="col-lg-4  mb-2">
      <button id="topdf" style="width: 100%;" class="btn bg-secondary btn-secondary" >Export PDF</button>
    </div>
    
  </div>
  </div>
</main>


<script src="{% static 'admin/js/html2pdf.bundle.js' %}"></script>


<script type="text/javascript" src="https://cdn.jsdelivr.net/jquery/latest/jquery.min.js"></script>
<script type="text/javascript" src="https://cdn.jsdelivr.net/momentjs/latest/moment.min.js"></script>
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.min.js"></script>
<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.css" />
<script type="text/javascript" src="https://unpkg.com/xlsx@0.15.1/dist/xlsx.full.min.js"></script>


<script>
    $('input[name="dates"]').daterangepicker({
      maxDate: moment(),
      ignoreReadonly: true,
      format:'dd/mm/yyyy',
      allowInputToggle: true,
      defaultDate: false,
      useCurrent: false
    }
  );



  function ExportToExcel(type,e, fn, dl) {

    var rowCount = $("#salestable td").closest("tr").length;

      if(rowCount>0){

        e.preventDefault();
    var elt = document.getElementById('salestable2');
    var date = new Date().toISOString().slice(0,19);
    var wb = XLSX.utils.table_to_book(elt, { sheet: "sheet1" });
    return dl ?
      XLSX.write(wb, { bookType: type, bookSST: true, type: 'base64' }):
      XLSX.writeFile(wb, fn || ('SalesReport'+date+'.' + (type || 'xlsx')));

      }else{
        e.preventDefault()
        Swal.fire({
          icon: 'error',
          title: 'Oops...',
          text: 'No data in the table!'
        })
      }
    
 }


</script>











<!-- ./ content -->     
               
  </div>




  <!-- jQery -->

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <!-- <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
  <script src="https://www.paypal.com/sdk/js?client-id=AeS1O53pS0XIj2PQq6VCwSi4eTAhyFwrm04d-I8l8sYKaPdVOOFPq87afE5QgTGDQM6jd-K01_5Mu2p-&currency=USD" data-sdk-integration-source="button-factory"></script> -->


  <script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>



  <script src="{% static 'admin/js/html2pdf.bundle.js'%}"></script>
  
  <script>
  
    document.getElementById('topdf').onclick = function() {

      var rowCount = $("#salestable td").closest("tr").length;

      if(rowCount>0){

        var element = document.getElementById('salestable2');
      var date = new Date().toISOString().slice(0,19);
      var opt = {
        margin:     1,
        filename: 'Salesreport' +date + '.pdf',
        image: { type: 'jpeg', quality: 0.98},
        html2canvas: { scale: 2},
        jsPDF: { unit: 'in', format: 'letter', orientation: 'portrait'}
  
      }

      
      html2pdf(element, opt)

      }else{
        Swal.fire({
          icon: 'error',
          title: 'Oops...',
          text: 'No data in the table!'
        })
      }

  
    };


    function csvBtn(url,e){

      var rowCount = $("#salestable td").closest("tr").length;

      if(rowCount>0){
        location.href=url;
      }else{
        e.preventDefault()
        Swal.fire({
          icon: 'error',
          title: 'Oops...',
          text: 'No data in the table!'
        })
      }
      
    }


  </script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js" integrity="sha512-GsLlZN/3F2ErC5ifS5QtgpiJtWd43JWSuIgh7mbzZ8zBps+dvLusV+eNQATqgA/HdeKFVgA5v3S/cIrLF7QnIg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

  {% endblock %}